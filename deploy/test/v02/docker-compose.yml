version: "3"
services:

  front:
    image: nexus.rzd/rzd-hub/oup/effect-react:0.1
    ports:
      - "8080:8080"
    environment:
      - TZ=Europe/Moscow
    deploy:
      restart_policy:
        condition: on-failure

  back:
    image: nexus.rzd/rzd-hub/oup/effect-fastapi:0.1
    ports:
      - "8081:8081"
    environment:
      - TZ=Europe/Moscow
      - KAFKA_ADVERTISED_LISTENERS=rzd-universalservgvc-t-kafka-1.gvc.oao.rzd:9092,rzd-universalservgvc-t-kafka-2.gvc.oao.rzd:9092,rzd-universalservgvc-t-kafka-3.gvc.oao.rzd:9092
    volumes:
      - "/effect/backend/config:/app/backend/config"
      - "/effect/backend/logs:/app/backend/logs"
      - "/effect/backend/files:/app/backend/files"
      - "/effect/backend/docs:/app/backend/docs"
    deploy:
      restart_policy:
        condition: on-failure

  nginx:
    image: nexus.rzd/rzd-hub/oup/effect-nginx-test:0.1
    ports:
      - "80:80"
    environment:
      - TZ=Europe/Moscow
    deploy:
      restart_policy:
        condition: on-failure

  broker:
    image: nexus.rzd/rzd-hub/oup/effect-broker:0.1
    ports:
      - "5000:5000"
    environment:
      - TZ=Europe/Moscow
      - KAFKA_ADVERTISED_LISTENERS=rzd-universalservgvc-t-kafka-1.gvc.oao.rzd:9092,rzd-universalservgvc-t-kafka-2.gvc.oao.rzd:9092,rzd-universalservgvc-t-kafka-3.gvc.oao.rzd:9092
    volumes:
      - "/effect/broker/config:/app/backend/config"
      - "/effect/broker/logs:/app/backend/logs"
    deploy:
      restart_policy:
        condition: on-failure
